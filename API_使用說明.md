# FinMind API 使用說明與限制

## 目前狀態

✅ **已完成的設定：**
1. FinMind API Token 已成功加入 `.env` 檔案
2. 程式已更新為使用 API Token 進行認證
3. 程式已加入 API 狀態檢查機制
4. 殖利率門檻已設定為 5%
5. 已實作日 KD 與周 KD 指標計算

⚠️ **目前遇到的限制：**
- FinMind API 已達到請求上限 (HTTP 402 錯誤)
- 訊息：`Requests reach the upper limit`

## FinMind API 限制說明

### 免費方案（即使有 Token）
- **每分鐘請求限制**：約 60 個請求/分鐘
- **每日請求限制**：視方案而定
- **限制重置時間**：
  - 分鐘限制：每分鐘重置
  - 日限制：每日 00:00 重置

### 為什麼會達到限制？

在測試過程中我們進行了：
1. 全台股掃描（1961 檔股票）
2. 每檔股票需要：
   - 1 次股利資料查詢
   - 1 次股價查詢
   - 1 次日 K 線查詢
   - 1 次周 K 線查詢
   - **總計約 4 次 API 請求/股票**

**總請求量**: 1961 × 4 = 約 7,844 個請求

這遠超過了免費方案的限制。

## 解決方案

### 方案 1：等待配額重置（建議）
```bash
# 等待 1-5 分鐘後重試
python find_high_dividend_stocks.py
```

如果還是失敗，等到隔天再執行。

### 方案 2：使用較小的股票清單

程式已內建高股息候選清單（97檔），包括：
- 金融股（28XX系列）
- 電信股（2412, 3045等）
- 傳產股（水泥、塑化、食品等）
- 其他高股息股（99XX系列）

這樣可以將請求量降低到約 **400 個請求**，更容易在限制內完成。

### 方案 3：升級 FinMind 方案

訪問 https://finmindtrade.com/ 升級到付費方案，可獲得：
- 更高的每分鐘請求限制
- 更高的每日請求限制
- 更快的 API 回應速度

## 程式功能確認

✅ **已實作的功能：**

1. **環境變數配置**
   - `.env` 檔案包含所有必要設定
   - FinMind API Token 已正確配置
   - Shioaji 登入開關可切換

2. **API 狀態檢查**
   - 程式執行前自動檢查 API 狀態
   - 達到限制時顯示清楚的錯誤訊息
   - 提供解決方案指引

3. **殖利率篩選**
   - 設定門檻：5%
   - 自動計算：(現金股利 ÷ 股價) × 100%

4. **KD 指標計算**
   - 日 K、日 D（9 日週期）
   - 周 K、周 D（9 周週期）
   - 使用標準 RSV 公式

5. **輸出格式**
   ```
   股票 | 股價 | 股利 | 殖利率 | 日K | 日D | 周K | 周D | 年度
   ```

## 下次執行建議

1. **等待幾分鐘**（讓分鐘配額重置）
2. **執行程式**：
   ```bash
   python find_high_dividend_stocks.py
   ```
3. **如果還是達到限制**，等到明天（或升級方案）

## 測試結果說明

之前的測試已成功：
- ✅ 掃描了 1961 檔台股
- ✅ 使用 7% 門檻時找到 8 檔股票
- ✅ 確認殖利率計算正確（例如 8422 的 26.12%）

程式功能是完整且正確的，只是受到 API 請求限制的影響。

## 相關檔案

- `find_high_dividend_stocks.py` - 主程式
- `.env` - 環境變數設定（包含 API Token）
- `demo_high_dividend_with_kd.py` - 示範程式（使用模擬資料）

## 聯絡支援

如需更多協助，請訪問：
- FinMind 官網：https://finmindtrade.com/
- FinMind API 文件：https://finmind.github.io/
