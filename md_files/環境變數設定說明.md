# 永豐證券 Shioaji API 環境變數設定說明

## 為什麼要使用環境變數？

✅ **安全性**：避免 API Key 直接寫在程式碼中
✅ **靈活性**：不同環境（開發/測試/生產）可使用不同的 Key
✅ **版本控制**：程式碼可以安全地提交到 Git，不會洩漏密鑰

---

## 設定方式

### 方式一：PowerShell 臨時設定（當前視窗有效）

```powershell
# 設定 API Key
$env:SINOPAC_API_KEY = "您的API_KEY"
$env:SINOPAC_SECRET_KEY = "您的SECRET_KEY"

# 可選：憑證路徑和密碼（如果與預設值不同）
$env:SINOPAC_CA_PATH = "C:/ekey/551/您的身分證號/S/Sinopac.pfx"
$env:SINOPAC_CA_PASSWORD = "您的憑證密碼"

# 驗證是否設定成功
echo $env:SINOPAC_API_KEY
```

**優點**：快速測試  
**缺點**：關閉 PowerShell 後失效

---

### 方式二：PowerShell Profile 自動設定（推薦開發使用）

1. 編輯 PowerShell Profile：
```powershell
notepad $PROFILE
```

2. 在檔案中加入：
```powershell
# 永豐證券 API 環境變數
$env:SINOPAC_API_KEY = "您的API_KEY"
$env:SINOPAC_SECRET_KEY = "您的SECRET_KEY"
```

3. 重新載入 Profile：
```powershell
. $PROFILE
```

**優點**：每次開啟 PowerShell 自動載入  
**缺點**：Profile 檔案需要妥善保管

---

### 方式三：Windows 系統環境變數（推薦生產使用）

1. 按 `Win + R`，輸入 `sysdm.cpl`
2. 點選「進階」→「環境變數」
3. 在「使用者變數」或「系統變數」中新增：
   - `SINOPAC_API_KEY` = 您的 API Key
   - `SINOPAC_SECRET_KEY` = 您的 Secret Key
   - `SINOPAC_CA_PATH` = 憑證路徑（選填）
   - `SINOPAC_CA_PASSWORD` = 憑證密碼（選填）

4. 重新啟動 PowerShell 或 VS Code

**優點**：永久有效，所有程式都能使用  
**缺點**：需要重啟應用程式才能生效

---

### 方式四：.env 檔案（適合專案管理）

1. 在專案資料夾建立 `.env` 檔案：
```env
SINOPAC_API_KEY=您的API_KEY
SINOPAC_SECRET_KEY=您的SECRET_KEY
SINOPAC_CA_PATH=C:/ekey/551/J120420374/S/Sinopac.pfx
SINOPAC_CA_PASSWORD=J120420374
```

2. 安裝 python-dotenv：
```powershell
pip install python-dotenv
```

3. 在程式開頭加入：
```python
from dotenv import load_dotenv
load_dotenv()  # 載入 .env 檔案
```

4. **重要**：在 `.gitignore` 中加入 `.env`：
```
.env
*.env
```

**優點**：專案獨立配置，易於管理  
**缺點**：需要額外安裝套件

---

## 驗證設定

### 查看目前的環境變數：
```powershell
# PowerShell
echo $env:SINOPAC_API_KEY
echo $env:SINOPAC_SECRET_KEY

# CMD
echo %SINOPAC_API_KEY%
echo %SINOPAC_SECRET_KEY%
```

### 測試程式是否能讀取：
```python
import os
print("API_KEY:", os.getenv("SINOPAC_API_KEY", "未設定"))
print("SECRET_KEY:", os.getenv("SINOPAC_SECRET_KEY", "未設定"))
```

---

## 使用範例

### 已設定環境變數：
```powershell
# 設定環境變數
$env:SINOPAC_API_KEY = "GCoNeVLvBoACiPdECEiZ1nMyB1TJWRNrxN9EBgmjY6ts"
$env:SINOPAC_SECRET_KEY = "G4RSPDjtZEx7BM46e2ekfxB4n5YR1au2RpSbEfvcj9dK"

# 直接執行程式（會自動讀取環境變數）
python SinoPac-new.py
python SinoPac-close.py
```

### 未設定環境變數：
程式會使用預設的硬編碼值（不建議用於生產環境）

---

## 安全建議

⚠️ **絕對不要**：
- 將 API Key 提交到公開的 Git repository
- 在聊天室或論壇分享 API Key
- 使用截圖分享含有 API Key 的畫面

✅ **建議做法**：
- 使用環境變數或 .env 檔案
- 定期更換 API Key
- 為不同環境（開發/生產）使用不同的 Key
- 將 .env 加入 .gitignore

---

## 常見問題

### Q: 程式找不到環境變數？
**A**: 
1. 確認環境變數名稱正確（區分大小寫）
2. 重新啟動 Terminal 或 VS Code
3. 檢查是否設定在正確的環境變數範圍（使用者/系統）

### Q: 要如何切換測試/正式環境？
**A**: 設定不同的環境變數：
```powershell
# 測試環境
$env:SINOPAC_API_KEY = "測試環境的KEY"
$env:SINOPAC_SECRET_KEY = "測試環境的SECRET"

# 或在程式中設定 simulation=True
```

### Q: 可以只設定部分環境變數嗎？
**A**: 可以。未設定的變數會使用程式中的預設值。建議至少設定：
- `SINOPAC_API_KEY` ✅ 必要
- `SINOPAC_SECRET_KEY` ✅ 必要
- `SINOPAC_CA_PATH` ⭕ 選填（預設值通常已足夠）
- `SINOPAC_CA_PASSWORD` ⭕ 選填（預設值通常已足夠）

---

## 快速開始

```powershell
# 1. 設定環境變數（選擇上述任一方式）
$env:SINOPAC_API_KEY = "您的API_KEY"
$env:SINOPAC_SECRET_KEY = "您的SECRET_KEY"

# 2. 執行程式
cd d:\PerryCoding\Python\SinoPac
python SinoPac-new.py

# 3. 確認登入成功
# 應該會看到 "✓ 登入成功！"
```

---

**最後更新**：2025-12-27  
**相關檔案**：SinoPac-new.py, SinoPac-close.py
