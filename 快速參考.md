# 資料庫系統 - 快速參考

## 常用命令

### 資料同步
```powershell
# 同步高殖利率候選股（推薦）
python sync_data.py --mode candidates

# 同步單一股票
python sync_data.py --stock 2330

# 測試模式（前10檔）
python sync_data.py --mode test

# 強制重新下載
python sync_data.py --mode candidates --force
```

### 資料查詢
```powershell
# 查詢高殖利率股票（自動使用資料庫）
python find_high_dividend_stocks.py

# 檢查資料庫狀態
python database_manager.py
```

### 資料庫管理
```powershell
# 重置資料庫
Remove-Item stock_data.db
python sync_data.py --mode candidates

# 檢查資料庫大小
Get-Item stock_data.db | Select-Object Name, @{Name='Size(MB)';Expression={$_.Length/1MB}}
```

## 檔案說明

| 檔案 | 用途 |
|------|------|
| `database_manager.py` | 資料庫管理核心 |
| `sync_data.py` | 資料同步工具 |
| `find_high_dividend_stocks.py` | 查詢程式（已整合資料庫） |
| `stock_data.db` | SQLite 資料庫檔案 |
| `.env` | 設定檔（USE_DATABASE=True） |

## 工作流程

```
1. 首次使用
   python sync_data.py --mode candidates  ← 下載資料（一次）
   
2. 日常查詢
   python find_high_dividend_stocks.py    ← 快速查詢（使用資料庫）
   
3. 定期更新（可選）
   python sync_data.py --mode candidates  ← 更新過期資料
```

## 效能對比

| 項目 | 無資料庫 | 有資料庫 |
|------|---------|---------|
| 查詢時間 | 20-30 分鐘 | 10-30 秒 |
| API 請求 | ~8,000 次 | ~10 次 |
| 達到限制 | 極易 | 極難 |

## 環境變數

```env
# .env 檔案設定

# 啟用資料庫（推薦）
USE_DATABASE=True

# 不使用資料庫
USE_DATABASE=False

# FinMind API Token
FINMIND_API_TOKEN=你的token

# Shioaji 登入（查詢歷史資料不需要）
ENABLE_SHIOAJI_LOGIN=False
```

## 故障排除

### API 限制
```powershell
# 等待 5-10 分鐘，或改用資料庫模式
# 確認 .env 中 USE_DATABASE=True
python find_high_dividend_stocks.py
```

### 資料庫錯誤
```powershell
# 刪除並重建
Remove-Item stock_data.db
python sync_data.py --mode test
```

### 資料過期
```powershell
# 強制更新
python sync_data.py --mode candidates --force
```

## Python API 使用

```python
from database_manager import init_database

# 初始化
db = init_database()

# 讀取股利
dividend_data = db.get_dividend_data('2330', start_date='2022-01-01')

# 讀取股價
price_data = db.get_daily_price('2330', start_date='2024-01-01')

# 最新股價
price = db.get_latest_price('2330')

# 統計
stats = db.get_database_stats()

# 關閉
db.close()
```

## 資源連結

- [資料庫使用指南.md](資料庫使用指南.md) - 完整教學
- [資料庫系統_現況說明.md](資料庫系統_現況說明.md) - 當前狀態
- [API_使用說明.md](API_使用說明.md) - API 限制說明
